version: "2"
services:
  mongodb:
    image: mongo
      
    ports:
     - "27017:27017"

    container_name: <projet>-mongodb

    environment:
    - MONGO_INITDB_ROOT_USERNAME=${USER_NAME}
    - MONGO_INITDB_ROOT_PASSWORD=${PASSWORD}
    - MONGO_INITDB_DATABASE=${APP}

    entrypoint: /bin/sh
    command: -c "chown mongodb:mongodb -R /data && /usr/local/bin/docker-entrypoint.sh mongod"
    volumes:
      # - ./data:/data
      - ./init-mongo.js:/docker-entrypoint-initdb.d/init-mongo.js:ro
      - ./data/configdb:/data/configdb
      - ./data/db:/data/db
      - ./data/json_db:/data/json_db

    networks: 
      network_<projet>:
        ipv4_address: 172.27.0.1
  
  
  mongodb_debug:
    image: mongo

    stdin_open: true
    tty: true
    
    entrypoint: /bin/sh
    command: -s 
    #command: -c "chown mongodb:mongodb -R /data"
    ports:
     - "27017:27017"

    volumes:
    #  - ./data:/data/
     - ./data/configdb:/data/configdb
     - ./data/db:/data/db
     - ./data/json_db:/data/json_db

networks: 
  network_<projet>:
    driver: bridge
    ipam:
      driver: default
      config:
        - subnet: 172.27.0.0/24
          gateway: 172.27.0.2